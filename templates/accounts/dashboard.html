{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Sistema de Seguros UTPL{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="bi bi-speedometer2"></i> Dashboard
            <small class="text-muted">Bienvenido, {{ user_full_name }}</small>
        </h1>
    </div>
</div>

<!-- Admin Dashboard -->
{% if user.role == 'admin' %}
<div class="row">
    <!-- Key Metrics -->
    <div class="col-md-3 mb-4">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h5 class="card-title">Pólizas Activas</h5>
                        <h3>{{ active_policies }}</h3>
                    </div>
                    <i class="bi bi-file-earmark-text fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h5 class="card-title">Por Vencer (30 días)</h5>
                        <h3>{{ expiring_policies_30 }}</h3>
                    </div>
                    <i class="bi bi-exclamation-triangle fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h5 class="card-title">Por Vencer (7 días)</h5>
                        <h3>{{ expiring_policies_7 }}</h3>
                    </div>
                    <i class="bi bi-exclamation-triangle-fill fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h5 class="card-title">Total Pólizas</h5>
                        <h3>{{ total_policies }}</h3>
                    </div>
                    <i class="bi bi-check-circle fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Financial Metrics -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-cash"></i> Facturación</h5>
            </div>
            <div class="card-body">
                <p class="mb-1">Pendientes: <strong>{{ pending_invoices }}</strong></p>
                <p class="mb-1">Vencidas: <strong class="text-danger">{{ overdue_invoices }}</strong></p>
                <p class="mb-1">Pronto Pago: <strong class="text-success">{{ early_payment_invoices }}</strong></p>
                <hr>
                <p class="mb-0">Total Pendiente: <strong>${{ total_pending_amount|floatformat:2 }}</strong></p>
            </div>
        </div>
    </div>

    <!-- Claims Status -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-exclamation-circle"></i> Siniestros</h5>
            </div>
            <div class="card-body">
                {% for status_data in claims_by_status %}
                <p class="mb-1">
                    {{ status_data.status|title }}: <strong>{{ status_data.count }}</strong>
                </p>
                {% endfor %}
                <hr>
                <p class="mb-0 text-warning">Atrasados: <strong>{{ overdue_claims }}</strong></p>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-activity"></i> Actividad Reciente</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">Actividad reciente del sistema aparecerá aquí.</p>
                <!-- This would be populated with recent system activity -->
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Requester Dashboard -->
{% if user.role == 'requester' %}
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-box-seam"></i> Mis Bienes</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <h4 class="text-primary">{{ my_assets }}</h4>
                        <p class="mb-0">Total de bienes</p>
                    </div>
                    <div class="col-6">
                        <h4 class="text-success">{{ insured_assets }}</h4>
                        <p class="mb-0">Asegurados</p>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <a href="{% url 'assets:asset_list' %}" class="btn btn-primary btn-sm">Ver Bienes</a>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-exclamation-triangle"></i> Mis Siniestros</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <h4 class="text-primary">{{ my_claims }}</h4>
                        <p class="mb-0">Total de siniestros</p>
                    </div>
                    <div class="col-6">
                        <h4 class="text-warning">{{ pending_claims }}</h4>
                        <p class="mb-0">En proceso</p>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <a href="{% url 'claims:claim_list' %}" class="btn btn-primary btn-sm">Ver Siniestros</a>
                <a href="{% url 'claims:claim_create' %}" class="btn btn-success btn-sm ms-2">Reportar Siniestro</a>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Default Dashboard for other roles -->
{% if user.role not in 'admin,requester' %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-info">
            <h4><i class="bi bi-info-circle"></i> Dashboard en Desarrollo</h4>
            <p>El dashboard personalizado para su rol ({% for choice in user.ROLE_CHOICES %}{% if choice.0 == user.role %}{{ choice.1 }}{% endif %}{% endfor %}) está en desarrollo.</p>
            <p>Use el menú de navegación para acceder a las funciones disponibles.</p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
